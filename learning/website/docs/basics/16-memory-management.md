# 显存管理的艺术：从静态分配到 PagedAttention

## 核心目标
理解 PagedAttention 如何借鉴操作系统虚拟内存的思想，解决 KV Cache 的碎片化问题。

## 1. 传统显存管理的痛点
- **静态分配**: 必须按最大可能长度预分配显存。
- **内部碎片**: 实际长度远小于最大长度时，大量显存浪费。
- **外部碎片**: 剩余显存总量够，但没有连续空间。

## 2. 操作系统启示录：虚拟内存
- **页 (Page)** 与 **页框 (Page Frame)**。
- **页表 (Page Table)**: 逻辑地址到物理地址的映射。

## 3. PagedAttention 原理
- **Block Table**: 维护每个请求的逻辑块到物理块的映射。
- **非连续存储**: KV Cache 可以存储在不连续的物理显存中。
- **动态分配**: 按需申请物理块，用完即还。

## 4. 优势
- 显存利用率接近 100%。
- 支持更大的 Batch Size。
- 方便实现 Copy-on-Write (Beam Search 场景)。
